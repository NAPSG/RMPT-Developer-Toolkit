// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/3.15/esri/copyright.txt and http://www.arcgis.com/apps/webappbuilder/copyright.txt for details.
//>>built
require({cache:{"builder/SetPortalUrl":function(){define("dojo/_base/lang dojo/_base/declare dojo/_base/html dojo/topic dojox/validate/regexp dijit/_WidgetBase dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dojo/text!./templates/SetPortalUrl.html dojo/Evented dojo/request dojo/Deferred dojo/keys dojo/cookie dojo/store/Memory dojo/request/script jimu/dijit/LoadingIndicator jimu/portalUrlUtils ./tokenUtils esri/request esri/arcgis/OAuthInfo esri/IdentityManager dijit/form/TextBox dijit/form/ValidationTextBox jimu/dijit/URLComboBox".split(" "),
function(e,k,b,l,f,r,q,d,y,m,t,g,w,u,n,z,x,h,v,A,D,B){return k([m,r,q,d],{baseClass:"jimu-set-portal-url",templateString:y,label:"setportalurl",defaultExpires:20160,invalidInput:!0,_portalUrlInputStatus:"uncheck",_validPortalUrls:null,_UrlEnterKeyDown:!1,_continueClick:!1,_oauthCheckError:null,currentDef:null,signinInfo:null,currentPortalUrl:null,postMixInProperties:function(){this.nls=window.builderNls;this.jimuNls=window.jimuNls},postCreate:function(){this.inherited(arguments);this.signinInfos=
[];this._validPortalUrls=[];this.loading||(this.loading=new x);this.loading.placeAt(this.domNode);this.loading.show();this.loadingUrl=b.create("div",{"class":"loadingUrl"},this.portalUrlInput.domNode);this.invalidUrl=b.create("div",{"class":"invalidUrl"},this.portalUrlInput.domNode);this.validUrl=b.create("div",{"class":"validUrl"},this.portalUrlInput.domNode);this.signinInfo={portalUrl:"",supportsOAuth:!1,appId:null};b.addClass(this.portalUrlInput.domNode,"portalUrlInput");this._getFAQHelpLink().then(e.hitch(this,
function(a){b.setStyle(this.faqNode,"display","inline-block");b.setAttr(this.faqNode,"href",a)}));this.portalUrlInput.set("missingMessage",this.nls.missingMessage);this.portalUrlInput.set("invalidMessage",this.nls.invalidMessage);this._getSigninInfos().then(e.hitch(this,function(a){var c=new n({data:a});this.signinInfos=a;this.portalUrlInput.set("store",c);this.portalUrlInput.set("searchAttr","portalUrl");this.currentPortalUrl?this.portalUrlInput.set("value",this.currentPortalUrl):a[0]&&a[0].portalUrl&&
this.portalUrlInput.set("value",a[0].portalUrl)}),e.hitch(this,function(a){console.error(a)})).always(e.hitch(this,function(){this.loading.hide()}))},_writeWabCurrentPortalUrlToCookie:function(a){u("wab_portalurl",a,{path:"/webappbuilder"});u("wab_portalurl",a,{path:"/webappviewer"});u("wab_portalurl_persistent",a,{path:"/",expires:365})},_getFAQHelpLink:function(){var a=new g;window.isXT?t("/webappbuilder/help/exists",{handleAs:"json"}).then(e.hitch(this,function(c){c&&c.exists?t("/webappbuilder/help/cxhelp.js",
{handleAs:"json"}).then(e.hitch(this,function(c){var b="#";c&&c.m&&c.m["120000962"]&&(b="/webappbuilder/help/"+c.m["120000962"]);a.resolve(b)}),e.hitch(this,function(c){console.warn(c);a.resolve("#")})):a.resolve("#")}),function(c){console.log(c);a.resolve("#")}):a.resolve("#");return a},_getSigninInfos:function(){var a=new g;t("/webappbuilder/rest/signininfo/getsignininfos",{handleAs:"json"}).then(e.hitch(this,function(c){c.success?a.resolve(c.infos):a.resolve([])}),e.hitch(this,function(c){a.reject(c)}));
return a},setPortalUrl:function(a,c){this._oauthCheckError={portalUrl:a,error:c};this.currentPortalUrl=a;this.portalUrlInput.set("value",a)},_isValidAppIdInPortalUrl:function(a){return this._oauthCheckError?!h.isSamePortalUrl(a,this._oauthCheckError.portalUrl)||"invalid_client_id"!==this._oauthCheckError.error&&"invalid_redirect_uri"!==this._oauthCheckError.error?!0:!1:!0},_onPortalUrlKeyDown:function(a){(a.keyCode?a.keyCode:a.which)===w.ENTER?(this._UrlEnterKeyDown=!0,this.portalUrlInput.onBlur()):
(this._continueClick=this._UrlEnterKeyDown=!1,this._portalUrlInputStatus="uncheck",this._hideAllStatus(),b.setStyle(this.appIdDiv,"display","none"),this.appIdInput.set("value",""),this._cancelValidating())},_cancelValidating:function(){this.currentDef&&!this.currentDef.isCanceled()&&(this._portalUrlInputStatus="uncheck",this.currentDef.cancel(),b.setStyle(this.invalidUrl,"display","none"),b.setStyle(this.errorRemind,"display","none"))},_onPortalUrlBlur:function(){this._switchPortalUrlInputStatus()},
_switchPortalUrlInputStatus:function(){if("checking"!==this._portalUrlInputStatus){b.setStyle(this.appIdDiv,"display","none");var a=this.portalUrlInput.get("value");0>a.toLowerCase().indexOf("http://")&&0>a.toLowerCase().indexOf("https://")&&(a=h.setHttpProtocol(a));a=h.getStandardPortalUrl(a);if(this._isValidPortalUrl(a)){var c=this._getSigninInfo(a);c.portalUrl=a;this._showValidStatus();this.signinInfo=c;!c||!c.isWebTier&&c.supportsOAuth?c&&c.appId?(this.appIdInput.set("value",c.appId),this._UrlEnterKeyDown&&
this._onContinue()):(b.setStyle(this.appIdDiv,"display","block"),this._UrlEnterKeyDown=!1,this.appIdInput.set("value","")):this._UrlEnterKeyDown&&this._onContinue()}else this.appIdInput.set("value",""),this._UrlEnterKeyDown=!1,this._cancelValidating(),this._validatePortal()}},_isValidPortalUrl:function(a){for(var c=0,b=this._validPortalUrls.length;c<b;c++)if(h.isSamePortalUrl(a,this._validPortalUrls[c]))return!0;return!1},_onPortalUrlChange:function(){this._switchPortalUrlInputStatus()},_onAppIdInputKeyDown:function(a){(a.keyCode?
a.keyCode:a.which)===w.ENTER&&(this.signinInfo.appId=this.appIdInput.get("value"),this.continueBtn.focus(),this.continueBtn.click(),a.stopPropagation())},_onAppIdInputChange:function(){var a=this.signinInfo.appId,c=this.appIdInput.get("value");this.signinInfo.appId=c;this.signinInfo.supportsOAuth&&!this.signinInfo.appId?b.addClass(this.continueBtn,"Cont-btn-disable"):(b.removeClass(this.continueBtn,"Cont-btn-disable"),a!==c&&(b.removeClass(this.appIdInput.domNode,"errorStatus"),b.setStyle(this.appIdErrorNode,
"display","none")))},_updateSigninInfo:function(a){var c=new g;t("/webappbuilder/rest/signininfo/setsignininfo",{handleAs:"json",data:a,method:"POST"}).then(e.hitch(this,function(b){b.success&&this._writeWabCurrentPortalUrlToCookie(a.portalUrl);c.resolve(b)}),e.hitch(this,function(a){c.reject(a)}));return c},_allowNamedorLocal:function(a){var c="^"+f.url({allowNamed:!1,allowLocal:!1});return(new RegExp(c,"g")).test(a)},_validatePortalExist:function(a){var c=new g;a=h.getPortalSelfInfoUrl(a);a=h.setHttpsProtocol(a);
this.currentDef=z.get(a+"?f\x3djson",{handleAs:"json",jsonp:"callback",timeout:6E4});this.currentDef.then(e.hitch(this,function(a){c.resolve(a&&a.hasOwnProperty("portalName"))}),e.hitch(this,function(a){console.error(a);c.resolve(!1)}));return c},_validatePortal:function(){this.portalUrlInput.get("value")?b.setStyle(this.remind,"display","none"):b.setStyle(this.remind,"display","block");var a=this.portalUrlInput.get("value");a&&(this.portalUrlInput.validator(this.portalUrlInput.get("value"))&&(a=
this.portalUrlInput.get("value")),0>a.toLowerCase().indexOf("http://")&&0>a.toLowerCase().indexOf("https://")&&(a=h.setHttpProtocol(a)),/www.arcgis.com/gi.test(a)||!this._allowNamedorLocal(a)?this._showInvalidStatus():(this._showValidatingStatus(),a=h.getStandardPortalUrl(a),b.addClass(this.continueBtn,"Cont-btn-disable"),this._validatePortalExist(a).then(e.hitch(this,function(c){c?this._postProcessPortal(a):(this._showInvalidStatus(),b.setStyle(this.appIdDiv,"display","none"))}))))},_getPortalSelf:function(a){var c=
{url:a+"/sharing/rest/portals/self",content:{f:"json"},handleAs:"json",timeout:15E3,callbackParamName:"callback",preventCache:!0};if(a=v.getPortalCredential(a))a.token&&(c.content.token=a.token),a.ssl&&(c.url=h.setHttpsProtocol(c.url));return A(c)},_postProcessPortal:function(a){this.currentDef=v.isWebTierPortal(a);this.currentDef.then(e.hitch(this,function(c){var d=v.getPortalCredential(a);d&&(d.ssl&&(a=h.setHttpsProtocol(a)),l.publish("userSignIn",d));this.currentDef=d=this._getPortalSelf(a);this.signinInfo=
{portalUrl:a};d.then(e.hitch(this,function(d){this.portalSelfInfo=d;if(d.isPortal||d.urlKey){var e=this._getSigninInfo(a);e||this.signinInfos.push(this.signinInfo);this._isValidPortalUrl(a)||this._validPortalUrls.push(a);this.signinInfo.supportsOAuth=d.supportsOAuth;if(c)this.signinInfo.isWebTier=!0,this._showValidStatus(),b.removeClass(this.continueBtn,"Cont-btn-disable");else if(this.signinInfo.appId=e?e.appId:"",this.signinInfo.supportsOAuth?this.signinInfo.appId?(this._isValidAppIdInPortalUrl(a)||
(b.setStyle(this.appIdDiv,"display","block"),b.addClass(this.appIdInput.domNode,"errorStatus"),b.setStyle(this.appIdErrorNode,"display","block")),this.appIdInput.set("value",this.signinInfo.appId)):b.setStyle(this.appIdDiv,"display","block"):b.setStyle(this.appIdDiv,"display","none"),this._showValidStatus(),b.removeClass(this.continueBtn,"Cont-btn-disable"),d=b.getStyle(this.appIdDiv,"display"),this.signinInfo.supportsOAuth&&"none"!==d)b.addClass(this.continueBtn,"Cont-btn-disable"),this.appIdInput.focus();
else if(this._UrlEnterKeyDown||this._continueClick)this._onContinue(),this._UrlEnterKeyDown=this._continueClick=!1}else this._showInvalidStatus(),console.error("should input full qualified org name")}),e.hitch(this,function(a){this._showInvalidStatus();console.error(a)}))}),e.hitch(this,function(a){this._showInvalidStatus();console.error(a)}))},_getSigninInfo:function(a){for(var c=0;c<this.signinInfos.length;c++)if(h.isSamePortalUrl(this.signinInfos[c].portalUrl,a))return e.clone(this.signinInfos[c]);
return null},_hideAllStatus:function(){b.setStyle(this.loadingUrl,"display","none");b.setStyle(this.validUrl,"display","none");b.setStyle(this.invalidUrl,"display","none");b.setStyle(this.errorRemind,"display","none")},_showValidStatus:function(){b.removeClass(this.portalUrlInput.domNode,"errorStatus");b.setStyle(this.loadingUrl,"display","none");b.setStyle(this.validUrl,"display","block");b.setStyle(this.invalidUrl,"display","none");b.setStyle(this.errorRemind,"display","none");this.invalidInput=
!1;this._portalUrlInputStatus="checked"},_showValidatingStatus:function(){b.removeClass(this.portalUrlInput.domNode,"errorStatus");b.setStyle(this.loadingUrl,"display","block");b.setStyle(this.validUrl,"display","none");b.setStyle(this.invalidUrl,"display","none");b.setStyle(this.errorRemind,"display","none");this.invalidInput=!0;this._portalUrlInputStatus="checking"},_showInvalidStatus:function(){b.addClass(this.portalUrlInput.domNode,"errorStatus");b.setStyle(this.portalUrlInput.domNode,"data-dojo-props",
"missingMessage:'IPUT URL'");b.setStyle(this.loadingUrl,"display","none");b.setStyle(this.validUrl,"display","none");b.setStyle(this.invalidUrl,"display","block");b.setStyle(this.errorRemind,"display","block");var a=this.portalUrlInput.get("value");/www.arcgis.com/gi.test(a)||!this._allowNamedorLocal(a)?this.errorRemind.innerHTML=this.nls.errOrg+"\x3cbr\x3ehttp://myorg.maps.arcgis.com\x3cbr\x3ehttp://myportal.company.com/arcgis":this.errorRemind.innerHTML=this.nls.errPrefix+a+"\x3cbr\x3e"+this.nls.errRemind;
this.invalidInput=!0;this._portalUrlInputStatus="checked"},_onContinue:function(){this.invalidInput||(this.signinInfo.isWebTier?l.publish("switchToMainPage",this.signinInfo):this.signinInfo.supportsOAuth?this.signinInfo.appId?this._updateSigninInfo(this.signinInfo).then(e.hitch(this,function(a){a.success&&this._oauthSignIn(this.signinInfo.portalUrl,this.signinInfo.appId)})):this.appIdInput.focus():(this._continueClick=this._UrlEnterKeyDown=!1,l.publish("switchToSignin",e.clone(this.signinInfo))))},
_oauthSignIn:function(a,c){v.signOutAll();a=h.getStandardPortalUrl(a);c=new D({appId:c,portalUrl:a,expiration:this.defaultExpires,authNamespace:"/",popup:!1,locale:window.dojoConfig.locale});B.registerOAuthInfos([c]);a=h.getSharingUrl(a);B.getCredential(a)}})})},"jimu/dijit/URLComboBox":function(){define(["dojo/_base/declare","dojo/_base/html","dijit/form/ComboBox","dojox/validate/regexp"],function(e,k,b,l){return e([b],{required:!0,invalidMessage:"Invalid url.",trim:!0,rest:!0,allowNamed:!1,allowLocal:!1,
declaredClass:"jimu.dijit.URLComboBox",postMixInProperties:function(){this.inherited(arguments);this.nls=window.jimuNls.urlInput;this.invalidMessage=this.nls.invalidUrl},postCreate:function(){this.inherited(arguments);k.addClass(this.domNode,"jimu-url-combobox")},validator:function(b){if(isFinite(b))return!1;var e="^"+l.url({allowNamed:this.allowNamed,allowLocal:this.allowLocal}),e=(new RegExp(e,"g")).test(b);return this.rest?(b=/\/rest\/services/gi.test(b),e&&b):e}})})},"builder/PortalSignIn":function(){define("dojo/_base/declare dojo/_base/lang dojo/on dojo/topic dojo/_base/html dojo/request/registry dojo/keys dojo/Deferred dojo/promise/all dijit/_WidgetBase dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dojo/text!./templates/PortalSignIn.html esri/request jimu/portalUrlUtils jimu/dijit/CheckBox jimu/dijit/Message ./tokenUtils".split(" "),
function(e,k,b,l,f,r,q,d,y,m,t,g,w,u,n,z,x,h){return e([m,t,g],{templateString:w,nls:null,defaultExpires:20160,label:"signin",postMixInProperties:function(){this.inherited(arguments);this.nls=window.builderNls},postCreate:function(){this.inherited(arguments);this._hideAppIdTip();this._bindEvents()},_hideAppIdTip:function(){f.setStyle(this.appIdTipSection,"display","none")},_bindEvents:function(){this.remember=new z({label:this.nls.remember,checked:!1},this.remember);this.own(b(this.password,"blur",
k.hitch(this,this.changeSigninStatus)));this.own(b(this.domNode,"keydown",k.hitch(this,function(b){(b.keyCode?b.keyCode:b.which)===q.ENTER&&this._onSigninClick()})))},_generateTokenSignIn:function(b){var e=new d,g=h.xtGetCredentialFromCookie(b);if(g)return e.resolve(g),e;h.removeWabAuthCookie();b=n.getStandardPortalUrl(b);var m=n.setHttpsProtocol(b),g="/proxy.js?"+m+"/sharing/rest/generateToken";this.shelter.show(this.nls.signingIn+"...");r(g,{handleAs:"json",method:"POST",data:{request:"getToken",
username:f.getAttr(this.username,"value"),password:f.getAttr(this.password,"value"),referer:window.location.host,expiration:this.remember.checked?this.defaultExpires:120,f:"json"},headers:{"X-Requested-With":null}}).then(k.hitch(this,function(a){if(a&&a.token){this._clearUserPassword();var c="/proxy.js?"+n.getCommunitySelfUrl(m),d=this._getPortalSelf(a.token),c=r(c,{handleAs:"json",method:"POST",data:{token:a.token,f:"json"},headers:{"X-Requested-With":null}});y([d,c]).then(k.hitch(this,function(c){this.shelter.hide();
var d=c[0];c=c[1];if(c.orgId){var g=n.getProtocol(b)+":";!d.isPortal&&d.urlKey&&(this.signinInfo.portalUrl=g+"//"+d.urlKey.toLowerCase()+"."+d.customBaseUrl);c.username&&(d={server:n.getStandardPortalUrl(this.signinInfo.portalUrl),token:a.token,userId:c.username,expires:a.expires,referer:window.location.host,scope:"portal",isAdmin:"org_admin"===c.role},c=h.saveAndRegisterCookieToCredential(d),l.publish("userSignIn",c),e.resolve(d))}else new x({message:this.nls.namedUserTip,container:document.body})}),
k.hitch(this,function(a){console.error(a);this._loginStatus(!0);e.reject(a)}))}else this.shelter.hide(),this._loginStatus(!0),e.reject()}),k.hitch(this,function(a){this.shelter.hide();console.error(a);this._loginStatus(!0);e.reject(a)}));return e},setSigninInfo:function(b){this.signinInfo=b;f.setStyle(this.domNode,"display","block");var d=n.getStandardPortalUrl(b.portalUrl);this.forgot.href=d+"/home/troubleshoot.html";h.xtGetCredentialFromCookie(b.portalUrl)&&this._onSigninClick()},_getPortalSelf:function(b){var d=
{url:n.getPortalSelfInfoUrl(this.signinInfo.portalUrl),content:{f:"json"},handleAs:"json",callbackParamName:"callback",preventCache:!0};b&&(d.content.token=b);return u(d)},_onSigninClick:function(){this._generateTokenSignIn(this.signinInfo.portalUrl).then(k.hitch(this,function(){l.publish("switchToMainPage",this.signinInfo)}),k.hitch(this,function(b){console.error(b)}))},_onBackClick:function(){l.publish("switchToSetPortalUrl")},_loginStatus:function(b){b?(this.username.focus(),f.setStyle(this.errorNode,
"display","block")):f.setStyle(this.errorNode,"display","none")},_clearUserPassword:function(){this.username.value="";this.password.value=""},changeSigninStatus:function(){this.password.value?f.removeClass(this.signin,"signin-btn-disable"):f.hasClass(this.signin,"signin-btn-disable")||f.addClass(this.signin,"signin-btn-disable")}})})},"dojo/request/registry":function(){define(["require","../_base/array","./default!platform","./util"],function(e,k,b,l){function f(d,e){for(var m=q.slice(0),f=0,g;g=
m[f++];)if(g(d,e))return g.request.call(null,d,e);return b.apply(null,arguments)}function r(b,e){var d;e?(d=b.test?function(d){return b.test(d)}:b.apply&&b.call?function(){return b.apply(null,arguments)}:function(d){return d===b},d.request=e):(d=function(){return!0},d.request=b);return d}var q=[];f.register=function(b,e,f){var d=r(b,e);q[f?"unshift":"push"](d);return{remove:function(){var b;~(b=k.indexOf(q,d))&&q.splice(b,1)}}};f.load=function(d,k,m,l){d?e([d],function(d){b=d;m(f)}):m(f)};l.addCommonMethods(f);
return f})},"url:builder/templates/SetPortalUrl.html":'\x3cdiv\x3e\r\n  \x3cdiv class\x3d"content" data-dojo-attach-point\x3d"portalContent"\x3e\r\n    \x3cp class \x3d "specify-text-url"\x3e${nls.tip}\x3c/p\x3e\r\n\r\n    \x3cdiv class\x3d"portalUrlDiv" id\x3d"portalUrlDiv"\x3e\r\n      \x3cinput class\x3d"portalUrlInput" data-dojo-attach-point\x3d"portalUrlInput" name\x3d"portalUrl" type\x3d"text"\r\n      data-dojo-type\x3d"jimu/dijit/URLComboBox" data-dojo-attach-event\x3d"KeyDown: _onPortalUrlKeyDown,Change:_onPortalUrlChange,Blur:_onPortalUrlBlur" data-dojo-props\x3d"rest:false, allowNamed:true, allowLocal:true" /\x3e\r\n      \x3cdiv class\x3d"Remind" data-dojo-attach-point\x3d"remind" \x3e\r\n        \x3ctable\x3e\r\n          \x3ctr\x3e\r\n            \x3ctd\x3e${nls.example}:\x3c/td\x3e\x3ctd\x3ehttp://myportal.company.com/arcgis\x3c/td\x3e\r\n          \x3c/tr\x3e\r\n          \x3ctr\x3e\r\n            \x3ctd\x3e\x3c/td\x3e\x3ctd\x3ehttp://orgname.maps.arcgis.com\x3c/td\x3e\r\n          \x3c/tr\x3e\r\n        \x3c/table\x3e\r\n      \x3c/div\x3e\r\n      \x3cdiv class\x3d"errorRemind" data-dojo-attach-point\x3d"errorRemind"\x3e\x3c/div\x3e\r\n    \x3c/div\x3e\r\n    \x3cdiv class\x3d"appIdDiv" data-dojo-attach-point\x3d"appIdDiv"\x3e\r\n      \x3cp\x3e\r\n        \x3cspan\x3e\r\n          ${nls.appIdTip}\r\n        \x3c/span\x3e\r\n        \x3cspan\x3e(\x3c/span\x3e\r\n        \x3ca href\x3d"//developers.arcgis.com/web-appbuilder/guide/getstarted.htm#ESRI_SECTION1_F2CE6567CB854E4AB43F08EB64B3D7AE" target\x3d"_blank"\x3e${jimuNls.common.help}\x3c/a\x3e\r\n        \x3cspan\x3e)\x3c/span\x3e\r\n      \x3c/p\x3e\r\n      \x3cinput type\x3d"text" class\x3d"appIdInput" data-dojo-attach-point\x3d"appIdInput" data-dojo-type\x3d"dijit/form/ValidationTextBox" data-dojo-attach-event\x3d"Change: _onAppIdInputChange,KeyDown: _onAppIdInputKeyDown"\r\n      data-dojo-props\x3d\'required:true,placeHolder:"${nls.appIdPlaceHolder}"\'/\x3e\r\n      \x3clabel class\x3d"appIdError jimu-float-leading" data-dojo-attach-point\x3d"appIdErrorNode"\x3e${nls.appIdError}\x3c/label\x3e\r\n    \x3c/div\x3e\r\n    \x3cdiv class\x3d"ContinueBtn jimu-float-trailing" data-dojo-attach-point\x3d"continueBtn" data-dojo-attach-event\x3d"click:_onContinue"\x3e\r\n      ${nls.continueBtn}\r\n    \x3c/div\x3e\r\n    \x3cdiv class\x3d"trouble-shooting"\x3e\r\n      \x3ca data-dojo-attach-point\x3d"faqNode" target\x3d"_blank"\x3e${nls.faq}\x3c/a\x3e\r\n    \x3c/div\x3e\r\n  \x3c/div\x3e\r\n\x3c/div\x3e',
"url:builder/templates/PortalSignIn.html":'\x3cdiv class\x3d"jimu-portal-signin"\x3e\r\n  \x3clabel data-dojo-attach-point\x3d"errorNode" class\x3d"error-message"\x3e${nls.errorMessage}\x3c/label\x3e\r\n  \x3cdiv class\x3d"signin-content" data-dojo-attach-point\x3d"signinContentNode"\x3e\r\n    \x3cdiv data-dojo-attach-point\x3d"appIdTipSection" class\x3d"appid-tip-section" style\x3d"display:none;"\x3e\r\n      \x3cdiv\x3e${nls.appIdTip1}\x3c/div\x3e\r\n      \x3cdiv style\x3d"margin-top:20px;"\x3e\r\n        \x3cspan\x3e${nls.appIdTip2}\x3c/span\x3e\r\n        \x3ca class\x3dhelp-link target\x3d_blank href\x3d"http://doc.arcgis.com/en/arcgis-online/share-maps/add-items.htm#ESRI_SECTION2_20AF85308FD548B5ADBAE28836F66D3F"\x3e${nls.here}\x3c/a\x3e\r\n      \x3c/div\x3e\r\n    \x3c/div\x3e\r\n    \x3cdiv class\x3d"form"\x3e\r\n      \x3clabel\x3e${nls.username}\x3c/label\x3e\r\n      \x3cinput type\x3d"text" tabindex\x3d"1" data-dojo-attach-point\x3d"username" /\x3e\r\n      \x3clabel\x3e${nls.password}\x3c/label\x3e\r\n      \x3ca data-dojo-attach-point\x3d"forgot" style\x3d"margin-left:10px;" target\x3d"_blank" href\x3d"#"\x3e${nls.forgot}\x3c/a\x3e\r\n      \x3cinput type\x3d"password" tabindex\x3d"2" data-dojo-attach-point\x3d"password" /\x3e\r\n      \x3cdiv data-dojo-attach-point\x3d"remember"\x3e\x3c/div\x3e\r\n    \x3c/div\x3e\r\n    \x3cdiv class\x3d"operations"\x3e\r\n      \x3cdiv class\x3d"btn signin-btn jimu-float-trailing" data-dojo-attach-point\x3d"signin" tabindex\x3d"3" data-dojo-attach-event\x3d"onclick:_onSigninClick" \x3e${nls.con}\x3c/div\x3e\r\n      \x3cdiv class\x3d"btn jimu-trailing-margin2 jimu-float-trailing" data-dojo-attach-point\x3d"btnBack" data-dojo-attach-event\x3d"onclick:_onBackClick"\x3e${nls.back}\x3c/div\x3e\r\n    \x3c/div\x3e\r\n    \x3cdiv data-dojo-attach-point\x3d"shelter" data-dojo-type\x3d"jimu/dijit/LoadingShelter" data-dojo-props\x3d"hidden:true"\x3e\x3c/div\x3e\r\n  \x3c/div\x3e\r\n\x3c/div\x3e'}});
define("dojo/parser dojo/_base/html dojo/_base/lang dojo/_base/array dojo/on dojo/cookie dojo/request/xhr dojo/topic dijit/registry builder/tokenUtils jimu jimu/utils jimu/portalUrlUtils jimu/portalUtils jimu/dijit/ViewStack jimu/dijit/LoadingShelter ./SetPortalUrl ./PortalSignIn ./utils esri/config esri/urlUtils esri/request esri/IdentityManager".split(" "),function(e,k,b,l,f,r,q,d,y,m,t,g,w,u,n,z,x,h,v,A,D,B,a){function c(a){k.setStyle("pre-main-page","display","block");k.setStyle("main-page","display",
"none");null===p&&(p=new n({viewType:"dijit",views:[new x({},"portal-url-div"),new h({},"signin-div")]},"pre-main-page"),p.switchView("setportalurl"))}var p=null;d.subscribe("switchToSetPortalUrl",function(){c();p.switchView("setportalurl")});d.subscribe("switchToSignin",function(a){c();var b=window.location.href.replace("action\x3dsetportalurl","action\x3dsignin");g.changeLocation(b);p.switchView("signin");p.getViewByLabel("signin").setSigninInfo(a)});a._oAuthDfd=null;var C=r("wab_portalurl_persistent");
(function(){A.defaults.io.proxyUrl="/proxy.js";q("/webappbuilder/rest/signininfo/getsignininfo",{query:{portalUrl:C},handleAs:"json"}).then(function(a){if(a.success)if(a=a.info){var b;b=window.originalHash.replace("#","");b=g.hashToObject(b);if(b.access_token){var c=v.removeActionFromUrl(window.location.href);g.changeLocation(c);b.state||(b.state={portalUrl:C});b=m.registerAuth2Hash(b);d.publish("userSignIn",b);d.publish("switchToMainPage",a)}else b.error&&b.error_description?(c="unknown_error","invalid_request"===
b.error?"Invalid client_id"===b.error_description?c="invalid_client_id":"Invalid redirect_uri"===b.error_description&&(c="invalid_redirect_uri"):c="access_denied"===b.error?"access_denied":"unknown_error",d.publish("switchToSetPortalUrl"),p.getViewByLabel("setportalurl").setPortalUrl(a.portalUrl,c)):"setportalurl"===queryObject.action?(d.publish("switchToSetPortalUrl"),p.getViewByLabel("setportalurl").setPortalUrl(a.portalUrl)):"signin"===queryObject.action?a.supportsOAuth||a.isWebTier?(d.publish("switchToSetPortalUrl"),
p.getViewByLabel("setportalurl").setPortalUrl(a.portalUrl)):d.publish("switchToSignin",a):a.isWebTier?(d.publish("switchToSetPortalUrl"),p.getViewByLabel("setportalurl").setPortalUrl(a.portalUrl)):d.publish("switchToMainPage",a)}else d.publish("switchToSetPortalUrl"),p.getViewByLabel("setportalurl").setPortalUrl(C);else console.log("Unknow error")})})()});